<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dashboard — SDIT Nahwa Nur</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#0b1220;
      --card: rgba(255,255,255,.08);
      --stroke: rgba(255,255,255,.14);
      --text:#eaf0ff;
      --muted: rgba(234,240,255,.72);
      --accent:#22c55e;
      --warn:#f59e0b;
      --bad:#ef4444;
      --shadow: 0 20px 60px rgba(0,0,0,.35);
      --radius: 18px;
      --max: 1100px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:"Poppins", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:
        radial-gradient(900px 400px at 20% 10%, rgba(34,197,94,.18), transparent 60%),
        radial-gradient(900px 400px at 85% 25%, rgba(59,130,246,.18), transparent 60%),
        radial-gradient(900px 400px at 50% 100%, rgba(244,63,94,.10), transparent 55%),
        var(--bg);
      color:var(--text);
      line-height:1.6;
    }
    .container{max-width:var(--max); margin:0 auto; padding:24px}
    a{color:inherit; text-decoration:none}

    .topbar{
      position:sticky; top:0; z-index:10;
      backdrop-filter: blur(10px);
      background: rgba(11,18,32,.65);
      border-bottom: 1px solid rgba(255,255,255,.08);
    }
    .topbar-inner{
      max-width:var(--max);
      margin:0 auto;
      padding:14px 24px;
      display:flex;
      align-items:center;
      gap:14px;
      justify-content:space-between;
    }
    .brand{display:flex; align-items:center; gap:12px}
    .logo{
      width:42px; height:42px; border-radius:14px;
      background: linear-gradient(135deg, rgba(34,197,94,.9), rgba(59,130,246,.9));
      box-shadow: 0 14px 30px rgba(0,0,0,.25);
      border: 1px solid rgba(255,255,255,.18);
    }
    .brand h1{font-size:16px; margin:0; line-height:1.2}
    .brand p{margin:0; font-size:12px; color:var(--muted)}

    .btn{
      display:inline-flex; align-items:center; justify-content:center;
      padding:10px 12px;
      border-radius: 12px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.08);
      font-weight:700;
      font-size:13px;
      cursor:pointer;
      user-select:none;
      gap:8px;
    }
    .btn.primary{
      background: linear-gradient(135deg, rgba(34,197,94,.95), rgba(59,130,246,.75));
      border:1px solid rgba(255,255,255,.20);
      color:#081018;
    }
    .btn.danger{
      border-color: rgba(239,68,68,.35);
      background: rgba(239,68,68,.12);
      color:#ffd1d1;
    }

    .grid{
      display:grid;
      grid-template-columns: 1fr .9fr;
      gap:16px;
      margin-top:16px;
    }
    .card{
      background: var(--card);
      border:1px solid var(--stroke);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }
    .panel{padding:16px}

    table{
      width:100%;
      border-collapse:separate;
      border-spacing:0;
      overflow:hidden;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.04);
    }
    thead th{
      text-align:left;
      font-size:12px;
      color:rgba(234,240,255,.85);
      padding:12px 12px;
      background: rgba(255,255,255,.06);
      border-bottom:1px solid rgba(255,255,255,.10);
    }
    tbody td{
      padding:12px 12px;
      font-size:13px;
      border-bottom:1px solid rgba(255,255,255,.08);
      color: rgba(234,240,255,.92);
      vertical-align:top;
    }
    tbody tr:last-child td{border-bottom:none}

    .badge{
      display:inline-block;
      font-size:12px;
      padding:5px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      margin-right:6px;
      margin-top:4px;
      white-space:nowrap;
    }
    .badge.ok{border-color: rgba(34,197,94,.45)}
    .badge.warn{border-color: rgba(245,158,11,.55)}
    .badge.bad{border-color: rgba(239,68,68,.55)}

    .actions{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
    }

    label{display:block; margin:10px 0 6px; font-size:12px; color:var(--muted)}
    input, select{
      width:100%;
      padding:12px 12px;
      border-radius: 14px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.06);
      color: var(--text);
      outline:none;
    }
    input:focus, select:focus{border-color: rgba(34,197,94,.55)}
    .row2{display:grid; grid-template-columns: 1fr 1fr; gap:10px}
    .note{font-size:12px; color:var(--muted); margin:10px 0 0}

    @media (max-width: 980px){
      .grid{grid-template-columns:1fr}
    }
  </style>
</head>

<body>
  <div class="topbar">
    <div class="topbar-inner">
      <div class="brand">
        <div class="logo"></div>
        <div>
          <h1>SDIT Nahwa Nur</h1>
          <p>Dashboard Jadwal Mengajar (Admin)</p>
        </div>
      </div>

      <div class="actions">
        <button class="btn" id="btnReset">Reset Data Demo</button>
        <button class="btn danger" id="btnLogout">Logout</button>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="grid">

      <!-- TABEL JADWAL -->
      <div class="card panel">
        <h3 style="margin:0 0 10px;">Jadwal Mengajar</h3>

        <table>
          <thead>
            <tr>
              <th>Waktu</th>
              <th>Kelas</th>
              <th>Mapel</th>
              <th>Guru</th>
              <th>Status</th>
              <th>Aksi</th>
            </tr>
          </thead>
          <tbody id="scheduleBody"></tbody>
        </table>

        <p class="note">
          Catatan: Versi ini menyimpan data di <b>localStorage</b> (browser). Untuk bisa dipakai banyak user dan sinkron,
          nanti perlu database (Supabase/Firebase/MySQL).
        </p>
      </div>

      <!-- FORM INPUT -->
      <div class="card panel">
        <h3 style="margin:0 0 10px;">Tambah / Edit Jadwal</h3>

        <form id="scheduleForm">
          <input type="hidden" id="editId" value="" />

          <div class="row2">
            <div>
              <label>Mulai</label>
              <input id="start" type="time" required />
            </div>
            <div>
              <label>Selesai</label>
              <input id="end" type="time" required />
            </div>
          </div>

          <label>Kelas</label>
          <input id="kelas" type="text" placeholder="contoh: 4A" required />

          <label>Mata Pelajaran</label>
          <input id="mapel" type="text" placeholder="contoh: Matematika" required />

          <label>Nama Guru</label>
          <input id="guru" type="text" placeholder="contoh: Ust. Ahmad" required />

          <div class="actions" style="margin-top:12px;">
            <button class="btn primary" type="submit" id="btnSave">Simpan</button>
            <button class="btn" type="button" id="btnCancel" style="display:none;">Batal Edit</button>
          </div>
        </form>

        <div class="note" style="margin-top:12px;">
          <b>Status otomatis:</b> sistem akan memberi label <b>“Bentrok”</b> bila
          <u>guru yang sama</u> punya jadwal yang <u>tumpang tindih</u> pada jam yang sama.
        </div>
      </div>

    </div>
  </div>

  <script>
    // ====== Proteksi halaman: harus login ======
    const session = localStorage.getItem("sdit_session");
    if (!session) window.location.href = "login.html";

    // ====== Storage keys ======
    const KEY = "sdit_schedule_v1";

    // ====== Data demo awal ======
    const demo = [
      { id: crypto.randomUUID(), start:"07:30", end:"08:10", kelas:"4A", mapel:"Matematika", guru:"Ust. Ahmad" },
      { id: crypto.randomUUID(), start:"08:10", end:"08:50", kelas:"4A", mapel:"Bahasa Indonesia", guru:"Bu Siti" },
      { id: crypto.randomUUID(), start:"08:50", end:"09:30", kelas:"5B", mapel:"PAI", guru:"Ust. Ahmad" },
      { id: crypto.randomUUID(), start:"09:45", end:"10:25", kelas:"2C", mapel:"Bahasa Arab", guru:"Bu Nabila" },
      { id: crypto.randomUUID(), start:"10:25", end:"11:05", kelas:"6A", mapel:"IPA", guru:"Pak Dimas" }
    ];

    function loadSchedule(){
      const raw = localStorage.getItem(KEY);
      if (!raw){
        localStorage.setItem(KEY, JSON.stringify(demo));
        return [...demo];
      }
      try { return JSON.parse(raw) } catch { return [...demo] }
    }
    function saveSchedule(data){
      localStorage.setItem(KEY, JSON.stringify(data));
    }

    function timeToMin(t){
      const [h,m] = t.split(":").map(Number);
      return (h*60) + m;
    }
    function overlap(aStart, aEnd, bStart, bEnd){
      // overlap jika ada irisan waktu
      return aStart < bEnd && bStart < aEnd;
    }

    function computeStatus(items){
      // status "Bentrok" bila guru sama dan jam overlap
      return items.map(it => {
        const aS = timeToMin(it.start);
        const aE = timeToMin(it.end);

        let conflict = false;
        for (const other of items){
          if (other.id === it.id) continue;
          if (other.guru.trim().toLowerCase() !== it.guru.trim().toLowerCase()) continue;

          const bS = timeToMin(other.start);
          const bE = timeToMin(other.end);
          if (overlap(aS, aE, bS, bE)){
            conflict = true;
            break;
          }
        }
        return { ...it, status: conflict ? "BENTROK" : "OK" };
      });
    }

    const tbody = document.getElementById("scheduleBody");
    const form = document.getElementById("scheduleForm");

    const elEditId = document.getElementById("editId");
    const elStart = document.getElementById("start");
    const elEnd = document.getElementById("end");
    const elKelas = document.getElementById("kelas");
    const elMapel = document.getElementById("mapel");
    const elGuru = document.getElementById("guru");

    const btnCancel = document.getElementById("btnCancel");
    const btnReset = document.getElementById("btnReset");
    const btnLogout = document.getElementById("btnLogout");

    let data = loadSchedule();

    function render(){
      // urutkan
      const sorted = [...data].sort((a,b)=> timeToMin(a.start) - timeToMin(b.start));
      const withStatus = computeStatus(sorted);

      tbody.innerHTML = "";
      for (const row of withStatus){
        const tr = document.createElement("tr");

        const waktu = `${row.start}–${row.end}`;
        const statusBadge = row.status === "OK"
          ? `<span class="badge ok">OK</span>`
          : `<span class="badge bad">BENTROK</span><span class="badge warn">Cek jadwal guru</span>`;

        tr.innerHTML = `
          <td>${waktu}</td>
          <td>${escapeHtml(row.kelas)}</td>
          <td>${escapeHtml(row.mapel)}</td>
          <td>${escapeHtml(row.guru)}</td>
          <td>${statusBadge}</td>
          <td>
            <div class="actions">
              <button class="btn" data-action="edit" data-id="${row.id}">Edit</button>
              <button class="btn danger" data-action="del" data-id="${row.id}">Hapus</button>
            </div>
          </td>
        `;
        tbody.appendChild(tr);
      }
    }

    function escapeHtml(str){
      return String(str)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    function resetForm(){
      elEditId.value = "";
      form.reset();
      btnCancel.style.display = "none";
      document.getElementById("btnSave").textContent = "Simpan";
    }

    // Klik Edit/Hapus
    tbody.addEventListener("click", (e) => {
      const btn = e.target.closest("button");
      if (!btn) return;

      const action = btn.dataset.action;
      const id = btn.dataset.id;
      const found = data.find(x => x.id === id);
      if (!found) return;

      if (action === "edit"){
        elEditId.value = found.id;
        elStart.value = found.start;
        elEnd.value = found.end;
        elKelas.value = found.kelas;
        elMapel.value = found.mapel;
        elGuru.value = found.guru;

        btnCancel.style.display = "inline-flex";
        document.getElementById("btnSave").textContent = "Update";
        window.scrollTo({ top: 0, behavior: "smooth" });
      }

      if (action === "del"){
        const ok = confirm("Yakin mau hapus jadwal ini?");
        if (!ok) return;
        data = data.filter(x => x.id !== id);
        saveSchedule(data);
        render();
        resetForm();
      }
    });

    // Simpan/Update
    form.addEventListener("submit", (e) => {
      e.preventDefault();

      const start = elStart.value;
      const end = elEnd.value;

      if (timeToMin(end) <= timeToMin(start)){
        alert("Jam selesai harus lebih besar dari jam mulai.");
        return;
      }

      const payload = {
        start,
        end,
        kelas: elKelas.value.trim(),
        mapel: elMapel.value.trim(),
        guru: elGuru.value.trim()
      };

      const editId = elEditId.value;
      if (editId){
        data = data.map(x => x.id === editId ? ({...x, ...payload}) : x);
      } else {
        data.push({ id: crypto.randomUUID(), ...payload });
      }

      saveSchedule(data);
      render();
      resetForm();
    });

    btnCancel.addEventListener("click", resetForm);

    btnReset.addEventListener("click", () => {
      const ok = confirm("Reset ke data demo? Ini akan menghapus data jadwal yang sudah diinput di browser ini.");
      if (!ok) return;
      data = [...demo];
      saveSchedule(data);
      render();
      resetForm();
    });

    btnLogout.addEventListener("click", () => {
      localStorage.removeItem("sdit_session");
      window.location.href = "login.html";
    });

    render();
  </script>
</body>
</html>
